#!/usr/bin/env lua


local function set_env_unixonly(self, sep)
    local function string_split(self, sep)
            local sep, fields = sep or ":", {}
            local pattern = string.format("([^%s]+)", sep)
            self:gsub(pattern, function(c) fields[#fields+1] = c end)
            return fields
    end

    local path = debug.traceback()
    path = string_split(string_split(path, "%s")[3], ':')[1]
    path = path:gsub("/*$", ""):match("(.*)[/]+[^/]*") or ''
    path = path:gsub("/*$", ""):match("(.*)[/]+[^/]*") or ''
    path = path ..'/?.lua;'

    package.path = path..package.path
end

set_env_unixonly(self, sep)

local loader = require("luarocks.loader")
local command_line = require("luarocks.command_line")

local cfg = require("luarocks.cfg")
os.execute('mkdir -p ' .. cfg.site_config.LUAROCKS_ROCKS_TREE)

program_description = "LuaRocks main command-line interface"

commands = {
   help = "luarocks.help",
   pack = "luarocks.pack",
   unpack = "luarocks.unpack",
   build = "luarocks.build",
   install = "luarocks.install",
   search = "luarocks.search",
   list = "luarocks.list",
   remove = "luarocks.remove",
   make = "luarocks.make",
   download = "luarocks.download",
   path = "luarocks.path",
   show = "luarocks.show",
   new_version = "luarocks.new_version",
   lint = "luarocks.lint",
   write_rockspec = "luarocks.write_rockspec",
   purge = "luarocks.purge",
   doc = "luarocks.doc",
}

command_line.run_command(...)
